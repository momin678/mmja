$(function() {
    var e, r = (e = 0, function(t, a) {
        clearTimeout(e), e = setTimeout(t, a)
    });
    $(document).on("keypress", ".data-search-for-table", function(t) {
        13 == t.which && t.preventDefault()
    }), $(document).on("keyup", ".data-search-for-table", function(t) {
        t.preventDefault();
        var a = $(this),
            e = t.target.value,
            o = a.attr("data-url") + "?q=" + e;
        $.ajax({
            url: o,
            type: "GET",
            cache: !1,
            dataType: "json",
            success: function(t) {
                $(".all-data-by-paginate").empty().append(t)
            },
            error: function() {}
        })
    }), $(document).on("keyup", ".product-select-by-term", function(t) {
        var a = t.target.value,
            e = $(this),
            o = e.attr("data-url") + "?q=" + a;
        r(function() {
            $.ajax({
                url: o,
                type: "GET",
                cache: !1,
                dataType: "json",
                success: function(t) {
                    t.success ? t.success && null == t.stock || ($("#product_name").val(t.stock.transfer_item.product_title), "barcode" == e.attr("data-id") ? $("#product_code").val(t.stock.product_code) : "product_code" == e.attr("data-id") && $("#barcode").val(t.stock.product_barcode), $("#product_id").val(t.stock.product_id), $("#sale_quantity").val(1), $("#sale_price").val(t.stock.transfer_item.transfer_final_price), $("#sub_total").val(t.stock.transfer_item.transfer_final_price * $("#sale_quantity").val()), $(".stocks").html("Stock:" + t.stocks.toString()), $("#batch-count").html(t.batches.length), $("#batch").empty(), $.each(t.batches, function(t, a) {
                        $("#batch").append($("<option>", {
                            value: a.invoice,
                            text: a.invoice + "(Pr:" + a.price + ",Qt:" + a.quantity + ")"
                        }))
                    }), "barcode" == e.attr("data-id") && t.batches.length) : ($("#product_name").val(""), "barcode" == e.attr("data-id") ? $("#product_code").val("") : "product_code" == e.attr("data-id") && $("#barcode").val(""), $("#product_id").val(""), $("#sale_quantity").val(1), $("#sale_price").val(0), $("#sub_total").val(0), $(".stocks").html(""), $("#batch").empty(), $("#batch-count").html(""))
                },
                error: function() {}
            })
        }, 250)
    }), $(document).on("submit", ".form-sale-to-member", function(t) {
        t.preventDefault();
        var a = $(this),
            e = a.attr("action"),
            o = a.attr("method"),
            r = new FormData(this);
        $(".help-block").remove(), $.ajax({
            url: e,
            type: o,
            data: r,
            contentType: !1,
            cache: !1,
            processData: !1
        }).done(function(t) {
            if (1 == t.success) {
                $(".all-data-area").empty().append(t.page), $("#total_cost").val(t.totalFinalPrice), $("#total_vat").val(t.total_vat), $("#total_ep").val(t.total_ep);
                var a = Number($("#total_cost").val()),
                    e = Number($("#total_vat").val()),
                    o = Number($("#discount").val()),
                    r = Number($("#total_ep").val()),
                    l = parseFloat(a + e - o).toFixed(2),
                    n = Number($("#paid_amount").val()),
                    s = parseFloat(n - l).toFixed(2);
                $("#grand_total").val(l), 0 < n ? $("#return_amount").val(s) : $("#return_amount").val(0), r < 10 ? $(".user-create-modal-xl").addClass("disabled") : $(".user-create-modal-xl").removeClass("disabled"), $("#product_name").val(""), $("#product_code").val(""), $("#barcode").val(""), $("#product_id").val(""), $("#sale_quantity").val(1), $("#sale_price").val(0), $("#sub_total").val(0), $(".stocks").html(""), $("#batch").empty(), $("#batch-count").html(""), $("#barcode").focus()
            } else $.each(t.errors, function(t, a) {
                $("[name~='" + t + "']").after("<span class='help-block text-red'><strong>" + a + "</strong></span>")
            })
        }).fail(function() {
            alert("error")
        })
    }), $(document).on("click", ".data-delete", function(t) {
        t.preventDefault();
        var a = $(this),
            e = a.attr("href"),
            u = a.closest(".data-row");
        $.ajax({
            url: e,
            type: "GET",
            dataType: "json"
        }).done(function(t) {
            if (t.success) {
                u.remove(), $("#total_cost").val(t.totalFinalPrice), $("#total_vat").val(t.total_vat), $("#total_ep").val(t.total_ep);
                var a = Number($("#total_cost").val()),
                    e = Number($("#total_vat").val()),
                    o = Number($("#discount").val()),
                    r = Number($("#total_ep").val()),
                    l = parseFloat(a + e - o).toFixed(2),
                    n = Number($("#paid_amount").val()),
                    s = parseFloat(n - l).toFixed(2);
                if ($("#grand_total").val(l), 0 < n ? $("#return_amount").val(s) : $("#return_amount").val(0), r < 10) {
                    $(".user-create-modal-xl").addClass("disabled"), $(".member-info").text("").removeClass("w3-card");
                    var c = $("#member_id");
                    c.val(""), c.closest(".form-group").removeClass(" has-error has-success"), c.next(".form-control-feedback").hide().removeClass("glyphicon-remove glyphicon-ok")
                } else $(".user-create-modal-xl").removeClass("disabled");
                $("#barcode").focus()
            }
        }).fail(function() {
            alert("error")
        })
    }), $(document).on("keyup", "#member_id", function(t) {
        t.preventDefault();
        var a = $(this),
            e = a.attr("data-url");
        $(".help-block").remove(), $(".member-info").text("").removeClass("w3-card"), r(function() {
            $.ajax({
                url: e + "?member_id=" + a.val(),
                type: "GET",
                cache: !1,
                dataType: "json",
                beforeSend: function() {
                    a.closest(".form-group").removeClass(" has-error has-success"), a.next(".form-control-feedback").hide().removeClass("glyphicon-remove glyphicon-ok")
                },
                complete: function() {}
            }).done(function(t) {
                t.success ? (a.closest(".form-group").addClass(" has-success"), a.next(".form-control-feedback").show().addClass("glyphicon-ok"), $(".member-info").text(t.member.name + " (" + t.member.mobile + ")").addClass("w3-card")) : (a.closest(".form-group").addClass(" has-error"), a.next(".form-control-feedback").show().addClass("glyphicon-remove"), $(".member-info").text("").removeClass("w3-card"))
            }).fail(function() {})
        }, 800)
    }), $(document).on("keyup", "#discount", function() {
        $(".help-block").remove();
        var t = Number($(this).val()),
            a = Number($("#total_vat").val()),
            e = Number($("#total_cost").val()),
            o = parseFloat(e + a - t).toFixed(2),
            r = Number($("#paid_amount").val()),
            l = parseFloat(r - o).toFixed(2);
        $("#grand_total").val(o), 0 < r ? $("#return_amount").val(l) : $("#return_amount").val(0)
    }), $(document).on("keyup", "#paid_amount", function() {
        $(".help-block").remove();
        var t = Number($(this).val()),
            a = Number($("#total_cost").val()),
            e = Number($("#total_vat").val()),
            o = Number($("#discount").val()),
            r = parseFloat(a + e - o).toFixed(2),
            l = parseFloat(t - r).toFixed(2);
        $("#grand_total").val(r), 0 < t && 0 < l ? $("#return_amount").val(l) : $("#return_amount").val(0)
    }), $(document).on("click", ".only-save-btn", function(t) {
        t.preventDefault(), $(".final-save-and-print-btn").removeAttr("name"), $(".transfer-final-save").submit()
    }), $(document).on("click", ".final-save-and-print-btn", function(t) {
        t.preventDefault(), $(".transfer-final-save").submit()
    }), $(document).on("submit", ".transfer-final-save", function(t) {
        t.preventDefault();
        var a = $(this),
            e = a.attr("action"),
            o = a.attr("method"),
            r = new FormData(this);
        $(".final-save-btn").attr("type", "button"), $(".help-block").remove(), $.ajax({
            url: e,
            type: o,
            data: r,
            contentType: !1,
            cache: !1,
            processData: !1
        }).done(function(t) {
            if (0 == t.success) $(".final-save-btn").attr("type", "submit"), $.each(t.errors, function(t, a) {
                $("[name~='" + t + "']").after("<span class='help-block text-red'><strong>" + a + "</strong></span>")
            }), t.errorMessage && ($(".error-js-alert").show(), $(".errorMessage").empty().append(t.errorMessage));
            else {
                $(".success-js-alert").show();
                var a = $(".final-save-and-print-btn").attr("name");
                void 0 !== a && !1 !== a && window.open($(".final-save-and-print-btn").attr("data-print-url"), "_blank"), location.replace(window.location.href)
            }
        }).fail(function() {
            alert("error")
        })
    })
});
